 <!DOCTYPE html>
 <html lang="en"> 
 <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
		<meta name="author" content="">
	<title>BEDGASM BLOG</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<link href="css/jquery.bxslider.css" rel="stylesheet">
	<link href="css/homeReset.css" type="text/css" rel="stylesheet">
	<link href="css/officalHome.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/login.css">
	<link rel="stylesheet" type="text/css" href="css/personhome.css">

</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
			 aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li>
					<a href="index.html">Home</a>
				</li>
				<li >
					<a href="aboutme.html" onclick="">About Me</a>
				</li>
				<li>
					<a href="contact.html">Contact</a>
				</li>
			</ul>

			<ul class="nav navbar-nav navbar-right">
				<li>
					<a id="login-button" class="btn big-login" data-toggle="modal" href="javascript:void(0)" onclick="openLoginModal()">登录</a>
				</li>
				<li>
					<a id="signin-button" class="btn big-register" data-toggle="modal" href="javascript:void(0)" onclick="openRegisterModal();">注册</a>
				</li>
				<li id="account" style="display: none;">
					<a id="accountname" onmouseover="showPromptBox()" onmouseout="closePromptBox()"></a>
				</li>
			</ul>

		</div>
		<!--/.nav-collapse -->
		<div id="prompt-box" onmouseover="showPromptBox()" onmouseout="closePromptBox()">
			<!-- <p><a href="personHome.html">个人中心</p> -->
			<p>
				<a onclick="gohome()">我的首页</a>
			</p>
			<p>
				<a onclick="gomanager()">管理站点</a>
			</p>
			
			<p>
				<a  onclick="logout()">退出登录</a>
			</p>
		</div>


	</nav>

	<div class="modal fade login " id="loginModal">
		<div class="modal-dialog login animated">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title">Login with</h4>
				</div>
				<div class="modal-body">
					<div class="box">
						<div class="content">

							<div class="error"></div>
							<div class="form loginBox">
								<form method="post" accept-charset="UTF-8">
									<input id="nameoremail" class="form-control" type="text" placeholder="用户名" name="nameoremail">
									<span class="error error5"></span>
									<input id="loginpwd" class="form-control" type="password" placeholder="密码" name="password">
									<span class="error error6"></span>
									<input id="loginBtn" class="btn btn-default btn-login" type="button" value="登 录" onclick="loginAjax()">
									<span class="error" id="loginfail"></span>
								</form>
							</div>
						</div>
					</div>
					<div class="box">
						<div class="content registerBox" style="display:none;">
							<div class="form">
								<form method="post" html="{:multipart=>true}" data-remote="true" accept-charset="UTF-8">
									<input id="username" class="form-control form-control1 " type="text" placeholder="用户名(4-16位)" name="username">
									<span class="error error1 "></span>

									<input id="email" class="form-control form-control1" type="text" placeholder="邮箱" name="email">
									<span class="error error2 "></span>

									<input id="pwd" class="form-control form-control1" type="password" placeholder="密码(8-30位)" name="pwd">
									<span class="error error3 "></span>

									<input id="password_confirmation" class="form-control form-control1" type="password" placeholder="确认密码" name="password_confirmation">
									<span class="error error4 "></span>

									<input id="register-button" class="btn btn-default btn-register" type="button" value="注 册" name="commit" onclick="register()">
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<div class="forgot login-footer">
						<span>还没账号?
							<a href="javascript: showRegisterForm();">去注册&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
						</span>
						<span>
							<a href="forgetpassword.html">(忘记密码?)</a>
						</span>
					</div>
					<div class="forgot register-footer" style="display:none">
						<span>已有账号?</span>
						<a href="javascript: showLoginForm();">去登录</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="wrap-col">
		<div class="logo"><a href="index.html"><img class="becenter" src="images/bigLogo.png"/></a></div>	
		<h4 class="tagline becenter">记录过去，憧憬未来 &nbsp; 向下扎根，向上生长</h4>
	</div>

	 <div class="container container2">
			<div class="row">
				<div class="forget">
					<h2>重置密码</h2>
				</div>
				<div class="col-md-12 resetok forget" style="display: none;">
					<input type="password" id="inputpass" placeholder="请输入新密码"><br>
					<input type="password" id="confirmpass" placeholder="请确认密码"><br>
					<input type="button" onclick="resetpass()" value="修改" id="resetpass">
				</div>
				
			</div>
	</div> 


	<footer class="footer footer2">

			<div class="footer-bottom">
				<h5>感谢使用Bedgasm Blog</h5>
				<i class="fa fa-copyright"></i> Copyright 2018 Bedgasm Blog. All Rights Reserved.<br>
				
			</div>
	</footer>

	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script type="text/javascript " src="js/login.js "></script>
	<script type="text/javascript" src="js/prompt.js"></script>
	<script type="text/javascript" src="js/forgetpassword.js"></script>
	<script src="js/mooz.scripts.min.js"></script>
		<script src="js/sweetalert2.all.min.js"></script>
	<script src="js/nav.js"></script>
	<script type="text/javascript">
	var regex = /.*?rescode=([0-9a-f]*)/ig;
	var resUrl = window.location.href;
	var rescode = regex.exec(resUrl)[1];
	console.log(rescode);

	var settings = {
	  "async": true,
	  "crossDomain": true,
	  "url": "http://www.bedgasmblog.cn/user/checkResetUrl",
	  "method": "POST",
	  "headers": {
	    "Content-Type": "application/x-www-form-urlencoded"
	  },
	  xhrFields: {
	      withCredentials: true
	  },
	  "data": {
	      "rescode": rescode
	  }
	}

	$.ajax(settings).done(function (response) {
		console.log(response);
		if(response.success==true){
			$(".resetok").css("display","block");
		}		
		else {
			swal("链接失效！请重新再试","","error");
		}
	});
	</script>

	<script>
		function resetpass(){

			var firstpass = $("#inputpass").val();
			var confirmpass = $("#confirmpass").val();

			reg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[\s\S]{8,30}$/;

            if (firstpass == "") {
               swal('密码不能为空！','','error');
            } else if (!reg.test($("#inputpass").val())) {
               swal("格式错误，至少包含数字、大小写字母！","","error");
            } else if (firstpass == confirmpass){
			  var settings = {
			  "async": true,
			  "crossDomain": true,
			  "url": "http://www.bedgasmblog.cn/user/resetUserPassword",
			  "method": "POST",
			  "headers": {
			    "Content-Type": "application/x-www-form-urlencoded"
			  },
			  xhrFields: {
			      withCredentials: true
			  },
			  "data": {
			      "rescode": rescode,
			      "password": confirmpass
			  }
			}

			$.ajax(settings).done(function (response) {
				if (response.success==true) {
					swal("重置密码成功！2秒后回到首页","","success");
					setTimeout("location.href='index.html'",2000);
				}
				else{
					swal("重置密码错误！","","error");
				}
			});

			}
			else if (firstpass != confirmpass)
			{
				swal("两次密码不同！请重新输入！","","error");
			}
			
		}
	</script>

</body>

</html>